let isNumber,getSymbolDataByType,findTrendsForSymbol,DAILY;_1a0‍.w("lodash",[["isNumber",["isNumber"],function(v){isNumber=v}]]);_1a0‍.w("../../stock-probability-analyzer/dynamicConditions/helper",[["getSymbolDataByType",["getSymbolDataByType"],function(v){getSymbolDataByType=v}]]);_1a0‍.w("../../stock-probability-analyzer/ConditionOccurrences/helpers",[["findTrendsForSymbol",["findTrendsForSymbol"],function(v){findTrendsForSymbol=v}]]);_1a0‍.w("../../stock-data-collector/technicals/constants",[["DAILY",["DAILY"],function(v){DAILY=v}]]);




class DataToolsController {
  static async getTrendDetectionData(req, res) {
    const { symbol } = req.params;
    const { maxPeriods = 7, minPercentChange = 5 } = req.query;

    if (symbol) {
      let dailyData = await getSymbolDataByType(DAILY, symbol);
      let trendsFound = getDataForTrendDetection(dailyData, maxPeriods, minPercentChange);

      if ("limit" in req.query && isNumber(parseInt(req.query.limit))) {
        trendsFound = trendsFound.slice(trendsFound.length - parseInt(req.query.limit));
      }

      res.json({ status: "success", data: trendsFound });
    }
  }
}

const getDataForTrendDetection = (symbolData, maxPeriods, minPercentChange) => {
  return findTrendsForSymbol(symbolData, maxPeriods, minPercentChange);
};

module.exports = DataToolsController;
